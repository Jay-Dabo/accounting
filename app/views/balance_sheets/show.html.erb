<% title("Laporan Neraca") %>

<div class="report-header">
    <h1 class="text-center white-text">
        Neraca Tahun <%= @balance_sheet.year %>
    </h1>
    <h2 class="text-center white-text">
        <%= @firm.name.titleize %>
    </h2>
</div>

<div class="table-list">

    <div class="row">
        <!-- Aktiva Col-->
        <div class="col-sm-6">
            <hr>
            <h3 class="text-center">Aset</h3>
            <hr>

            <div class="panel report panel-success">
                <div class="panel-heading clickable">
                    <h5 class="panel-title">
                        Kas dan Setara Kas
                    <span class="badge"><i class="fa fa-chevron-down"></i></span>                        
                    </h5>
                    <span class="pull-right badge"id="report">
                        <%= idr_money(@balance_sheet.cash) %>
                    </span>
                </div>
                <div class="panel-body">
                    <ul>
                        <li>Saldo Awal Tahun: <%= idr_money(@firm.current_cash_flow.beginning_cash) %></li>
                        <li>Perubahan Saldo: <%= idr_money(@firm.current_cash_flow.net_change) %></li>
                    </ul>
                </div>
            </div>
            <div class="panel report panel-success">
                <div class="panel-heading clickable">
                    <h5 class="panel-title">
                        Piutang Usaha
                        <span class="badge"><i class="fa fa-chevron-down"></i></span>                        
                    </h5>
                    <span class="pull-right badge"id="report">
                        <%= idr_money(@balance_sheet.receivables) %>
                    </span>
                </div>
                <div class="panel-body">
                    <ul>
                        <li>Dari pembelian : <%= idr_money(@firm.revenues.operating.receivables.map{ |a| a.receivable }.compact.sum) %></li>
                        <li>Dari pendapatan non-operasi: <%= idr_money(@firm.revenues.others.receivables.map{ |a| a.receivable }.compact.sum) %></li>
                    </ul>       
                </div>
            </div>
            <div class="panel report panel-success">
                <div class="panel-heading clickable">
                    <h5 class="panel-title">
                        Stok Produk
                        <% unless @firm.type == 'Jasa' %>
                        <span class="badge"><i class="fa fa-chevron-down"></i></span>
                        <% end %>
                    </h5>
                    <span class="pull-right badge"id="report">
                        <%= idr_money(@balance_sheet.inventories) %>
                    </span>
                </div>
                <div class="panel-body">
                    <% if @firm.type == 'Manufaktur' %>
                        <li>Bahan Baku: <%= idr_money(@firm.materials.available.map{ |a| a.cost_remaining }.compact.sum) %></li>
                        <li>Produk Jadi: <%= idr_money(@firm.products.available.map{ |a| a.cost_remaining }.compact.sum) %></li>
                    <% elsif @firm.type == 'Jual-Beli' %>
                        <li>Pembelian: <%= idr_money(@firm.spendings.merchandises.map{ |a| a.total_spent }.compact.sum) %></li>
                        <li>Penjualan: <%= idr_money(@firm.revenues.merchandising.map{ |a| a.total_earned }.compact.sum) %></li>
                    <% end %>
                </div>
            </div>
            <div class="panel report panel-success">
                <div class="panel-heading clickable">
                    <h5 class="panel-title">
                        Persediaan Perlengkapan
                    </h5>
                    <span class="pull-right badge"id="report">
                        <%= idr_money(@balance_sheet.supplies) %>
                    </span>
                </div>
            </div>
            <div class="panel report panel-success">
                <div class="panel-heading clickable">
                    <h5 class="panel-title">
                        Aset Prabayar
                    </h5>
                    <span class="pull-right badge"id="report">
                        <%= idr_money(@balance_sheet.prepaids) %>
                    </span>
                </div>
            </div>

            <div class="panel report panel-success">
                <div class="panel-heading clickable">
                    <h5 class="panel-title">
                        Aset Tetap (Bersih)
                        <span class="badge"><i class="fa fa-chevron-down"></i></span>
                    </h5>
                    <span class="pull-right badge"id="report">
                        <%= idr_money(@balance_sheet.net_fixed_assets) %>
                    </span>
                </div>
                <div class="panel-body">
                    <ul>
                        <li>Aset Tetap Berwujud: <%= idr_money(@balance_sheet.fixed_assets) %></li>
                        <li>Aset Tetap Tidak Berwujud: <%= idr_money(@balance_sheet.other_fixed_assets) %></li>
                        <li>Akumulasi Penyusutan: <%= idr_money(@balance_sheet.accu_depr) %></li>
                    </ul>                
                </div>
            </div>     
            <div class="panel report panel-primary">
                <div class="panel-heading clickable">
                    <h5 class="panel-title">
                        Total Nilai Aset
                    </h5>
                    <span class="pull-right badge"id="report">
                        <%= idr_money(@balance_sheet.aktiva) %>
                    </span>
                </div>
            </div>
        </div>

        <div class="col-sm-6">
            <hr>
            <h3 class="text-center">Kewajiban & Hak Pemilik</h3>
            <hr>

            <div class="panel report panel-warning">
                <div class="panel-heading clickable">
                    <h5 class="panel-title">
                        Hutang Usaha
                        <span class="badge"><i class="fa fa-chevron-down"></i></span>
                    </h5>
                    <span class="pull-right badge"id="report">
                        <%= idr_money(@balance_sheet.payables) %>
                    </span>
                </div>
                <div class="panel-body">
                    <ul>
                        <li>Dari pembelian produk: <%= idr_money(@firm.spendings.merchandises.payables.map{ |a| a.payment_installed }.compact.sum) %></li>
                        <% if @firm.type == 'Manufaktur' %>
                            <li>Dari pembelian bahan baku: <%= idr_money(@firm.spendings.materials.payables.map{ |a| a.payment_installed }.compact.sum) %></li>
                        <% end %>
                        <li>Dari pembelian aset lancar: <%= idr_money(@firm.spendings.expendables.payables.map{ |a| a.payment_installed }.compact.sum) %></li>
                        <li>Dari pembelian aset tetap: <%= idr_money(@firm.spendings.assets.payables.map{ |a| a.payment_installed }.compact.sum) %></li>
                        <li>Dari pengeluaran: <%= idr_money(@firm.spendings.expenses.payables.map{ |a| a.payment_installed }.compact.sum) %></li>
                    </ul>                       
                </div>
            </div>
            <div class="panel report panel-warning">
                <div class="panel-heading clickable">
                    <h5 class="panel-title">
                        Pinjaman
                        <span class="badge"><i class="fa fa-chevron-down"></i></span>
                    </h5>
                    <span class="pull-right badge"id="report">
                        <%= idr_money(@balance_sheet.debts) %>
                    </span>
                </div>
                <div class="panel-body">
                    <ul>
                        <li>
                            Akan jatuh tempo dalam 1 tahun: <%= idr_money(@firm.loans.active.current.map{ |a| a.amount_balance }.compact.sum) %>
                        </li>
                        <li>
                            Akan jatuh tempo lebih dari 1 tahun: <%= idr_money(@firm.loans.active.long_term.map{ |a| a.amount_balance }.compact.sum) %>
                        </li>                        
                    </ul>
                </div>
            </div>
            <div class="stopgap">
                
            </div>
        </div>
        <div class="col-sm-6">

            <div class="panel report panel-info">
                <div class="panel-heading clickable">
                    <h5 class="panel-title">
                        Laba Ditahan 
                    </h5>
                    <span class="pull-right badge"id="report">
                        <%= idr_money(@balance_sheet.retained) %>
                    </span>
                </div>
            </div>
            <div class="panel report panel-info">
                <div class="panel-heading clickable">
                    <h5 class="panel-title">
                        Penarikan Dana
                    </h5>
                    <span class="pull-right badge"id="report">
                        <%= idr_money(@balance_sheet.drawing) %>
                    </span>
                </div>
            </div>
            <div class="panel report panel-info">
                <div class="panel-heading clickable">
                    <h5 class="panel-title">
                        Hak Pemilik
                    </h5>
                    <span class="pull-right badge"id="report">
                        <%= idr_money(@balance_sheet.capital) %>
                    </span>
                </div>
            </div>
            <div class="panel report panel-primary">
                <div class="panel-heading clickable">
                    <h5 class="panel-title">
                        Total Kewajiban & Hak Pemilik
                    </h5>
                    <span class="pull-right badge"id="report">
                        <%= idr_money(@balance_sheet.passiva) %>
                    </span>
                </div>
            </div>            
        </div>

    </div>

</div>



<% unless Rails.env.production? %>
    <div class="debug-balance">
        <%= @balance_sheet.closed %>
        <%= balanced?(@balance_sheet) %>
        <%= render 'debug_box' %>
    </div>
<% end %> 